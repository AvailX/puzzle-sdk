(function(o,m){typeof exports=="object"&&typeof module<"u"?m(exports,require("react"),require("@walletconnect/modal-sign-html"),require("events"),require("zustand"),require("@tanstack/react-query"),require("@puzzlehq/sdk-core"),require("@walletconnect/utils"),require("@puzzlehq/types"),require("debug"),require("react/jsx-runtime"),require("@tanstack/react-query-devtools"),require("zustand/middleware")):typeof define=="function"&&define.amd?define(["exports","react","@walletconnect/modal-sign-html","events","zustand","@tanstack/react-query","@puzzlehq/sdk-core","@walletconnect/utils","@puzzlehq/types","debug","react/jsx-runtime","@tanstack/react-query-devtools","zustand/middleware"],m):(o=typeof globalThis<"u"?globalThis:o||self,m(o["@puzzlehq/sdk-react"]=o["@puzzlehq/sdk-react"]||{},o.React,o.modalSignHtml,o.EventEmitter,o.zustand,o.reactQuery,o.sdkCore,o.utils,o.types,o.debug,o.jsxRuntime,o.reactQueryDevtools,o.middleware))})(this,function(o,m,$,B,Z,R,w,V,d,J,M,X,Y){"use strict";const N=["decrypt","disconnect","getSelectedAccount","getBalance","getRecords","requestCreateEvent","getEvent","getEvents","createSharedState","importSharedState","requestSignature"],C=["aleo:1"],T=["chainChanged","accountSelected","selectedAccountSynced","sharedAccountSynced"],F="f0aaeffe71b636da453fce042d79d723",H={standaloneChains:C,enableExplorer:!1,enableAccountView:!0,enableNetworkView:!0,enableStandaloneMode:!0,mobileWallets:[{id:"puzzle",name:"Puzzle Wallet",links:{native:"puzzleapp://",universal:""}}],desktopWallets:[{id:"puzzle",name:"Puzzle Wallet",links:{native:"",universal:"https://walletconnect.puzzle.online/"}},{id:"avail",name:"Avail Wallet",links:{native:"avail://",universal:"https://avail.global"}}],walletImages:{puzzle:"https://i.imgur.com/p9tHaFC.png",avail:"https://i.imgur.com/GxNn8BO.png"}},x={requiredNamespaces:{aleo:{methods:N,chains:C,events:T}}},P=new B;let b;function ee(e){b=new $.WalletConnectModalSign({projectId:F,metadata:{name:e.dAppName,description:e.dAppDescription,url:e.dAppUrl,icons:[e.dAppIconURL]},modalOptions:{...H}}),window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE")}async function f(){return new Promise(e=>{if(b)e(b);else{const t=setInterval(()=>{b&&(clearInterval(t),e(b))},200)}window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE")})}function L(e){m.useEffect(()=>(f().then(t=>{t.onSessionDelete(e)}),()=>{f().then(t=>{t.offSessionDelete(e)})}),[e])}function Q(e){m.useEffect(()=>(f().then(t=>{t.onSessionExpire(e)}),()=>{f().then(t=>{t.offSessionExpire(e)})}),[e])}function D(e){m.useEffect(()=>(f().then(t=>{t.onSessionUpdate(e)}),()=>{f().then(t=>{t.offSessionUpdate(e)})}),[e])}function S(){const[e,t]=m.useState(void 0);return L(n=>{n.topic===(e==null?void 0:e.topic)&&t(void 0)}),D(n=>{if(e&&n.topic===(e==null?void 0:e.topic)){const{namespaces:r}=n.params,c={...e,namespaces:r};t(c)}}),Q(n=>{e&&n.topic===(e==null?void 0:e.topic)&&t(void 0)}),m.useEffect(()=>{async function n(){const c=await(await f()).getSession();t(c)}return n(),P.on("session_change",n),()=>{P.off("session_change",n)}},[]),e}function _(e){m.useEffect(()=>(f().then(t=>{t.onSessionEvent(e)}),()=>{f().then(t=>{t.offSessionEvent(e)})}),[e])}const q=Z.create()(Y.persist((e,t)=>({account:void 0,chainId:"aleo:1",setAccount:n=>{e({account:n})},setChainId:n=>{e({chainId:n})},onDisconnect:()=>{e({account:void 0,chainId:void 0}),K.clear(),console.log("onDisconnect called!")}}),{name:"puzzle-wallet-store"}));function W(){const[e,t]=m.useState(void 0),[n,r]=m.useState(void 0),[c,s]=m.useState(!1);return{data:e,error:n,loading:c,setData:t,setError:r,setLoading:s}}async function G(e,t){const r=await(await f()).request(e);if(r===void 0&&t)throw console.error("Result is undefined, retrying..."),new Error("Result is undefined, retrying...");return r}function A({queryKey:e,wcParams:t,enabled:n,queryOptions:r}){return R.useQuery(e,async()=>G(t,e),r??{staleTime:e[0]==="getEvent"?7500:45e3,refetchInterval:e[0]==="getEvent"?5e3:3e4,refetchIntervalInBackground:!0,enabled:n,retry:!0})}function j(e){const{data:t,error:n,loading:r,setData:c,setError:s,setLoading:i}=W();async function a(g){try{i(!0),s(void 0);const u=await G(e??g);return c(u),u}catch(u){throw s(u),u}finally{i(!1)}}return{data:t,error:n,loading:r,request:a}}const O=(e,t=!0,n=4,r=!0)=>e?e.length<n?e:r?`(...${e.slice(-n)})`:e.length<n*2?e:`${e.slice(0,n+(t?5:0))}...${e.slice(e.length-n,e.length)}`:"",te=()=>{const e=S(),[t,n,r]=q(u=>[u.account,u.setAccount,u.onDisconnect]),{refetch:c,data:s,error:i,isLoading:a}=A({queryKey:["useAccount",e==null?void 0:e.topic],enabled:!!e,wcParams:{topic:e==null?void 0:e.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getSelectedAccount"}}});_(({params:u,topic:l})=>{if(u.event.name==="accountSelected"&&e&&e.topic===l){const v=u.event.address??u.event.data.address,p=u.chainId.split(":")[0],y=u.chainId.split(":")[1];n({network:p,chainId:y,address:v,shortenedAddress:O(v)})}}),D(({params:u,topic:l})=>{const h=u.event.address??u.event.data.address,v=u.chainId.split(":")[0],p=u.chainId.split(":")[1];n({network:v,chainId:p,address:h,shortenedAddress:O(h)})}),L(({params:u,topic:l})=>{r()}),m.useEffect(()=>{e&&!a&&c()},[e==null?void 0:e.topic]),m.useEffect(()=>{if(s){const u=s,l=u==null?void 0:u.account;l&&n(l)}},[s]);const g=i?i.message:s&&s.error;return{account:t,error:g,loading:a}},ne=({address:e,multisig:t})=>{const n=S(),[r]=q(h=>[h.account]),{refetch:c,data:s,error:i,isLoading:a}=A({queryKey:["useBalance",e,(r==null?void 0:r.address)??"",t,n==null?void 0:n.topic],enabled:!!n&&!!r&&(t?!!e:!0),wcParams:{topic:n==null?void 0:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getBalance",params:{assetId:void 0,address:e}}}});_(({params:h,topic:v})=>{const p=h.event.name,y=h.event.address??h.event.data.address;(p==="selectedAccountSynced"&&!t||p==="sharedAccountSynced"&&t&&y===e)&&c()}),m.useEffect(()=>{n&&!a&&c()},[n==null?void 0:n.topic]);const g=i?i.message:s&&s.error,u=s;return{balances:u==null?void 0:u.balances,error:g,loading:a}};function re(){const t=!!S(),{data:n,error:r,loading:c,setData:s,setError:i,setLoading:a}=W(),[g]=q(l=>[l.setAccount]);async function u(){try{a(!0),i(void 0);const h=await(await w.getWalletConnectModalSignClient()).connect({requiredNamespaces:{aleo:{methods:w.wc_aleo_methods,chains:w.wc_aleo_chains,events:w.wc_events}}});s(h);const v=h.namespaces.aleo.accounts[0].split(":");return g({network:v[0],chainId:v[1],address:v[2],shortenedAddress:O(v[2])}),w.emitter.emit("session_change"),window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE"),h}catch(l){throw i(l),l}finally{a(!1)}}return{data:n,error:r,loading:c,isConnected:t,connect:u}}const oe=()=>{const e=S(),{request:t,data:n,error:r,loading:c}=j({topic:(e==null?void 0:e.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"createSharedState",params:{}}}),s=r?r.message:n&&n.error,i=n;return{createSharedState:()=>{e&&!c&&t()},data:i==null?void 0:i.data,loading:c,error:s}},ce=e=>{w.log_sdk("useDecrypt",e);const t=S(),{request:n,data:r,error:c,loading:s}=j({topic:(t==null?void 0:t.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"decrypt",params:{ciphertexts:e}}}),i=c?c.message:r&&r.error,a=r;return{decrypt:()=>{e&&t&&!s&&n()},plaintexts:a==null?void 0:a.plaintexts,loading:s,error:i}};function se(){const e=S(),[t]=q(a=>[a.onDisconnect]),{error:n,loading:r,setError:c,setLoading:s}=W();async function i(){if(!e||r){e||t();return}try{s(!0),c(void 0);try{await(await w.getWalletConnectModalSignClient()).disconnect({topic:e.topic,reason:V.getSdkError("USER_DISCONNECTED")}),w.emitter.emit("session_change")}catch(a){console.warn(a)}q.getState().onDisconnect()}catch(a){throw c(a),a}finally{s(!1)}}return{error:n,loading:r,disconnect:i}}const ae=({id:e,address:t,multisig:n=!1})=>{const r=S(),[c]=q(E=>[E.account]),s=e!==void 0&&e!==""&&!!r&&!!c&&(n?!!t:!0),{refetch:i,data:a,error:g,isLoading:u}=A({queryKey:["useEvent",c==null?void 0:c.address,t,n,e,r==null?void 0:r.topic],enabled:s,wcParams:{topic:r==null?void 0:r.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getEvent",params:{id:e??"",address:t}}}});_(({params:E,topic:I})=>{const z=E.event.name,k=E.event.address??E.event.data.address;(e&&z==="selectedAccountSynced"&&!n||z==="sharedAccountSynced"&&n&&k===t)&&i()});const l=!!r&&!!c&&!!e&&(n?!!t:!0);m.useEffect(()=>{l&&!u&&i()},[l]);const h=()=>{l&&!u&&i()},v=g?g.message:a&&a.error,p=a,y=p==null?void 0:p.event;return{fetchEvent:h,event:y,error:v,loading:u}},ie=({filter:e,page:t})=>{const n=S(),[r]=q(y=>[y.account]);(e==null?void 0:e.programId)===""&&(e.programId=void 0);const{refetch:c,data:s,error:i,isLoading:a}=A({queryKey:["useEvents",r==null?void 0:r.address,e,t,n==null?void 0:n.topic],enabled:!!n&&!!r,wcParams:{topic:(n==null?void 0:n.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getEvents",params:{filter:e,page:t}}}});_(({id:y,params:E,topic:I})=>{E.event.name==="selectedAccountSynced"&&c()});const g=!!n&&!!r;m.useEffect(()=>{g&&!a&&c()},[g]);const u=()=>{g&&!a&&c()},l=i?i.message:s&&s.error,h=s,v=h==null?void 0:h.events,p=(h==null?void 0:h.pageCount)??0;return{fetchPage:u,events:v,error:l,loading:a,page:t,pageCount:p}},ue=e=>{const t=S(),{request:n,data:r,error:c,loading:s}=j({topic:(t==null?void 0:t.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"importSharedState",params:{seed:e}}}),i=c?c.message:r&&r.error,a=r;return{importSharedState:()=>{t&&!s&&n()},data:a==null?void 0:a.data,loading:s,error:i}},de=e=>{try{return JSON.stringify(e,null,2).replaceAll('"',"")??""}catch{return""}},le=({address:e,multisig:t=!1,filter:n,page:r})=>{const c=S(),[s]=q(I=>[I.account]),{refetch:i,data:a,error:g,isLoading:u}=A({queryKey:["useRecords",s==null?void 0:s.address,e,t,n,r,c==null?void 0:c.topic],enabled:(t?!!e:!0)&&!!c&&!!s,wcParams:{topic:c==null?void 0:c.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getRecords",params:{address:e,filter:n,page:r}}}}),l=!!c&&!!s&&(t?!!e:!0);_(({params:I})=>{const z=I.event.name,k=I.event.address??I.event.data.address;(z==="selectedAccountSynced"&&!t||z==="sharedAccountSynced"&&t&&k===e)&&i()});const h=()=>{l&&!u&&(w.log_sdk("useRecords refetching...",[e,t,n,r]),i())},v=g?g.message:a&&a.error,p=a,y=p==null?void 0:p.records,E=(p==null?void 0:p.pageCount)??0;return{fetchPage:h,records:y,error:v,loading:u,page:r,pageCount:E}},ge=e=>{const t=S(),n=e==null?void 0:e.inputs.map(l=>typeof l=="string"?l:l.plaintext),{request:r,data:c,error:s,loading:i}=j({topic:(t==null?void 0:t.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"requestCreateEvent",params:{...e,inputs:n}}}),a=s?s.message:c&&c.error,g=c;return{createEvent:()=>{e&&t&&!i&&(w.log_sdk("useCreateEvent requesting...",e),r())},eventId:g==null?void 0:g.eventId,loading:i,error:a}},U=J("wallet:sdk");U.enabled=!0;const he=(e,t)=>{const n=S(),{request:r,data:c,error:s,loading:i}=j({topic:(n==null?void 0:n.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"requestSignature",params:{message:e,address:d.aleoAddressRegex.test(t??"")?t:void 0}}}),a=s?s.message:c&&c.error;return{requestSignature:()=>{n&&!i&&(U("useRequestSignature requesting...",[e,t]),r())},response:c,loading:i,error:a}},K=new R.QueryClient,fe=({dAppName:e,dAppDescription:t,dAppUrl:n,dAppIconURL:r,children:c,debugQuery:s=!1})=>(m.useEffect(()=>{w.configureConnection({dAppName:e,dAppDescription:t,dAppUrl:n,dAppIconURL:r}),B.defaultMaxListeners=100},[]),M.jsxs(R.QueryClientProvider,{client:K,children:[s&&M.jsx(X.ReactQueryDevtools,{initialIsOpen:!1}),c]})),me=async()=>{const e=await f(),t=await e.getSession();if(!t||!e)return{error:"no session or connection"};try{return await e.request({topic:t.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getSelectedAccount"}})}catch(n){const r=n.message;return console.error("getAccount error",r),{error:r}}},pe=async({address:e})=>{const t=await f(),n=await t.getSession();if(!n||!t)return{error:"no session or connection"};try{return await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getBalance",params:{assetId:void 0,address:e}}})}catch(r){const c=r.message;return console.error("getBalance error",c),{error:c}}},ve=async()=>{const e=await f();if(!e)throw new Error("call setConnection() first!");const t=await e.getSession();if(t)return console.log("Already connected!",t),t;try{const n=await e.connect({requiredNamespaces:{aleo:{methods:N,chains:C,events:T}}});return P.emit("session_change"),window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE"),n}catch(n){console.error("connect error",n.message)}},Se=async e=>{const t=await f(),n=await(t==null?void 0:t.getSession());if(!n||!t)return{error:"no session or connection"};const r=e==null?void 0:e.inputs.map(c=>typeof c=="string"?c:c.plaintext);try{return await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"requestCreateEvent",params:{...e,inputs:r}}})}catch(c){const s=c.message;return console.error("createEvent error",s),{error:s}}},we=async()=>{const e=await f(),t=await(e==null?void 0:e.getSession());if(!t||!e)return{error:"no session or connection"};try{return await e.request({topic:t.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"createSharedState",params:{}}})}catch(n){const r=n.message;return console.error("createSharedState error",r),{error:r}}},ye=async e=>{const t=await f(),n=await(t==null?void 0:t.getSession());if(!n||!t)return{error:"no session or connection"};try{return await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"decrypt",params:{ciphertexts:e}}})}catch(r){return console.error("decrypt error",r.message),{error:r.message}}},Ee=async()=>{const e=await f(),t=await(e==null?void 0:e.getSession());if(!t||!e)return{error:"no session or connection"};try{try{await e.disconnect({reason:V.getSdkError("USER_DISCONNECTED"),topic:t.topic}),P.emit("session_change")}catch(n){console.warn(n)}return{}}catch(n){const r=n.message;return console.error("error disconnecting",r),{error:r}}},qe=async({id:e,address:t})=>{const n=await f(),r=await(n==null?void 0:n.getSession());if(!r||!n)return{event:void 0,error:"no session or connection"};const c=async()=>await n.request({topic:r.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getEvent",params:{id:e,address:t}}});try{return await c()}catch(s){const i=s.message;return console.error("getEvents error",i),{error:i}}},Ie=async e=>{const t=await f(),n=await(t==null?void 0:t.getSession());if(!n||!t)return{events:void 0,error:"no session or connection"};(e==null?void 0:e.programId)===""&&(e.programId=void 0);const r=async(c=0)=>await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getEvents",params:{filter:e,page:c}}});try{return await r()}catch(c){const s=c.message;return console.error("getEvents error",s),{error:s}}},_e=async e=>{const t=await f(),n=await(t==null?void 0:t.getSession());if(!n||!t)return{error:"no session or connection"};try{return await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"importSharedState",params:{seed:e}}})}catch(r){const c=r.message;return console.error("importSharedState error",c),{error:c}}},ze=async({address:e,filter:t,page:n=0})=>{const r=await f(),c=await(r==null?void 0:r.getSession());if(!c||!r)return{error:"no session or connection"};const s=async(i=0)=>await r.request({topic:c.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getRecords",params:{address:e,filter:t,page:i}}});try{return await s()}catch(i){const a=i.message;return console.error("getRecords error",a),{error:a}}},Pe=async({message:e,address:t})=>{const n=await f(),r=await(n==null?void 0:n.getSession());if(!r||!n)return{error:"no session or connection"};try{return await n.request({topic:r.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"requestSignature",params:{message:e,address:d.aleoAddressRegex.test(t??"")?t:void 0}}})}catch(c){const s=c.message;return console.error("signature error",s),{error:s}}},be=20;Object.defineProperty(o,"AssetType",{enumerable:!0,get:()=>d.AssetType}),Object.defineProperty(o,"EventStatus",{enumerable:!0,get:()=>d.EventStatus}),Object.defineProperty(o,"EventType",{enumerable:!0,get:()=>d.EventType}),Object.defineProperty(o,"Network",{enumerable:!0,get:()=>d.Network}),Object.defineProperty(o,"Visibility",{enumerable:!0,get:()=>d.Visibility}),Object.defineProperty(o,"aleoAddressRegex",{enumerable:!0,get:()=>d.aleoAddressRegex}),Object.defineProperty(o,"aleoFieldRegex",{enumerable:!0,get:()=>d.aleoFieldRegex}),Object.defineProperty(o,"aleoPrivateKeyRegex",{enumerable:!0,get:()=>d.aleoPrivateKeyRegex}),Object.defineProperty(o,"aleoTransactionIdRegex",{enumerable:!0,get:()=>d.aleoTransactionIdRegex}),Object.defineProperty(o,"aleoU32",{enumerable:!0,get:()=>d.aleoU32}),Object.defineProperty(o,"aleoU64",{enumerable:!0,get:()=>d.aleoU64}),Object.defineProperty(o,"aleoViewKeyRegex",{enumerable:!0,get:()=>d.aleoViewKeyRegex}),Object.defineProperty(o,"zodAddress",{enumerable:!0,get:()=>d.zodAddress}),Object.defineProperty(o,"zodEventStatus",{enumerable:!0,get:()=>d.zodEventStatus}),Object.defineProperty(o,"zodEventType",{enumerable:!0,get:()=>d.zodEventType}),Object.defineProperty(o,"zodField",{enumerable:!0,get:()=>d.zodField}),Object.defineProperty(o,"zodNetwork",{enumerable:!0,get:()=>d.zodNetwork}),Object.defineProperty(o,"zodPrivateKey",{enumerable:!0,get:()=>d.zodPrivateKey}),Object.defineProperty(o,"zodTransactionId",{enumerable:!0,get:()=>d.zodTransactionId}),Object.defineProperty(o,"zodU32",{enumerable:!0,get:()=>d.zodU32}),Object.defineProperty(o,"zodU64",{enumerable:!0,get:()=>d.zodU64}),Object.defineProperty(o,"zodViewKey",{enumerable:!0,get:()=>d.zodViewKey}),Object.defineProperty(o,"zodVisibility",{enumerable:!0,get:()=>d.zodVisibility}),o.PAGE_SIZE=be,o.PuzzleWalletProvider=fe,o.configureConnection=ee,o.connect=ve,o.createSharedState=we,o.decrypt=ye,o.disconnect=Ee,o.emitter=P,o.getAccount=me,o.getBalance=pe,o.getEvent=qe,o.getEvents=Ie,o.getFormattedRecordPlaintext=de,o.getRecords=ze,o.getWalletConnectModalSignClient=f,o.importSharedState=_e,o.log_sdk=U,o.projectId=F,o.queryClient=K,o.requestCreateEvent=Se,o.requestSignature=Pe,o.shortenAddress=O,o.signClient_puzzleProps=x,o.useAccount=te,o.useBalance=ne,o.useConnect=re,o.useCreateSharedState=oe,o.useDecrypt=ce,o.useDisconnect=se,o.useEvent=ae,o.useEvents=ie,o.useImportSharedState=ue,o.useOnSessionDelete=L,o.useOnSessionEvent=_,o.useOnSessionExpire=Q,o.useOnSessionUpdate=D,o.useRecords=le,o.useRequestCreateEvent=ge,o.useRequestSignature=he,o.useSession=S,o.wc_aleo_chains=C,o.wc_aleo_methods=N,o.wc_events=T,o.web3modal_puzzle_props=H,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
