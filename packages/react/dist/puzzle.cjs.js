"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const m=require("react"),H=require("@walletconnect/modal-sign-html"),K=require("events"),G=require("zustand"),R=require("@tanstack/react-query"),S=require("@puzzlehq/sdk-core"),B=require("@walletconnect/utils"),d=require("@puzzlehq/types"),$=require("debug"),k=require("react/jsx-runtime"),Z=require("@tanstack/react-query-devtools"),J=require("zustand/middleware"),N=["decrypt","disconnect","getSelectedAccount","getBalance","getRecords","requestCreateEvent","getEvent","getEvents","createSharedState","importSharedState","requestSignature"],z=["aleo:1"],x=["chainChanged","accountSelected","selectedAccountSynced","sharedAccountSynced"],V="f0aaeffe71b636da453fce042d79d723",M={standaloneChains:z,enableExplorer:!1,enableAccountView:!0,enableNetworkView:!0,enableStandaloneMode:!0,mobileWallets:[{id:"puzzle",name:"Puzzle Wallet",links:{native:"puzzleapp://",universal:""}}],desktopWallets:[{id:"puzzle",name:"Puzzle Wallet",links:{native:"",universal:"https://walletconnect.puzzle.online/"}},{id:"avail",name:"Avail Wallet",links:{native:"avail://",universal:"https://avail.global"}}],walletImages:{puzzle:"https://i.imgur.com/p9tHaFC.png",avail:"https://i.imgur.com/GxNn8BO.png"}},X={requiredNamespaces:{aleo:{methods:N,chains:z,events:x}}},C=new K;let b;function Y(e){b=new H.WalletConnectModalSign({projectId:V,metadata:{name:e.dAppName,description:e.dAppDescription,url:e.dAppUrl,icons:[e.dAppIconURL]},modalOptions:{...M}}),window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE")}async function g(){return new Promise(e=>{if(b)e(b);else{const t=setInterval(()=>{b&&(clearInterval(t),e(b))},200)}window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE")})}function T(e){m.useEffect(()=>(g().then(t=>{t.onSessionDelete(e)}),()=>{g().then(t=>{t.offSessionDelete(e)})}),[e])}function F(e){m.useEffect(()=>(g().then(t=>{t.onSessionExpire(e)}),()=>{g().then(t=>{t.offSessionExpire(e)})}),[e])}function L(e){m.useEffect(()=>(g().then(t=>{t.onSessionUpdate(e)}),()=>{g().then(t=>{t.offSessionUpdate(e)})}),[e])}function v(){const[e,t]=m.useState(void 0);return T(n=>{n.topic===(e==null?void 0:e.topic)&&t(void 0)}),L(n=>{if(e&&n.topic===(e==null?void 0:e.topic)){const{namespaces:r}=n.params,o={...e,namespaces:r};t(o)}}),F(n=>{e&&n.topic===(e==null?void 0:e.topic)&&t(void 0)}),m.useEffect(()=>{async function n(){const o=await(await g()).getSession();t(o)}return n(),C.on("session_change",n),()=>{C.off("session_change",n)}},[]),e}function _(e){m.useEffect(()=>(g().then(t=>{t.onSessionEvent(e)}),()=>{g().then(t=>{t.offSessionEvent(e)})}),[e])}const E=G.create()(J.persist((e,t)=>({account:void 0,chainId:"aleo:1",setAccount:n=>{e({account:n})},setChainId:n=>{e({chainId:n})},onDisconnect:()=>{e({account:void 0,chainId:void 0}),U.clear(),console.log("onDisconnect called!")}}),{name:"puzzle-wallet-store"}));function D(){const[e,t]=m.useState(void 0),[n,r]=m.useState(void 0),[o,s]=m.useState(!1);return{data:e,error:n,loading:o,setData:t,setError:r,setLoading:s}}async function Q(e,t){const r=await(await g()).request(e);if(r===void 0&&t)throw console.error("Result is undefined, retrying..."),new Error("Result is undefined, retrying...");return r}function P({queryKey:e,wcParams:t,enabled:n,queryOptions:r}){return R.useQuery(e,async()=>Q(t,e),r??{staleTime:e[0]==="getEvent"?7500:45e3,refetchInterval:e[0]==="getEvent"?5e3:3e4,refetchIntervalInBackground:!0,enabled:n,retry:!0})}function A(e){const{data:t,error:n,loading:r,setData:o,setError:s,setLoading:a}=D();async function c(l){try{a(!0),s(void 0);const i=await Q(e??l);return o(i),i}catch(i){throw s(i),i}finally{a(!1)}}return{data:t,error:n,loading:r,request:c}}const j=(e,t=!0,n=4,r=!0)=>e?e.length<n?e:r?`(...${e.slice(-n)})`:e.length<n*2?e:`${e.slice(0,n+(t?5:0))}...${e.slice(e.length-n,e.length)}`:"",ee=()=>{const e=v(),[t,n,r]=E(i=>[i.account,i.setAccount,i.onDisconnect]),{refetch:o,data:s,error:a,isLoading:c}=P({queryKey:["useAccount",e==null?void 0:e.topic],enabled:!!e,wcParams:{topic:e==null?void 0:e.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getSelectedAccount"}}});_(({params:i,topic:u})=>{if(i.event.name==="accountSelected"&&e&&e.topic===u){const f=i.event.address??i.event.data.address,h=i.chainId.split(":")[0],y=i.chainId.split(":")[1];n({network:h,chainId:y,address:f,shortenedAddress:j(f)})}}),L(({params:i,topic:u})=>{const p=i.event.address??i.event.data.address,f=i.chainId.split(":")[0],h=i.chainId.split(":")[1];n({network:f,chainId:h,address:p,shortenedAddress:j(p)})}),T(({params:i,topic:u})=>{r()}),m.useEffect(()=>{e&&!c&&o()},[e==null?void 0:e.topic]),m.useEffect(()=>{if(s){const i=s,u=i==null?void 0:i.account;u&&n(u)}},[s]);const l=a?a.message:s&&s.error;return{account:t,error:l,loading:c}},te=({address:e,multisig:t})=>{const n=v(),[r]=E(p=>[p.account]),{refetch:o,data:s,error:a,isLoading:c}=P({queryKey:["useBalance",e,(r==null?void 0:r.address)??"",t,n==null?void 0:n.topic],enabled:!!n&&!!r&&(t?!!e:!0),wcParams:{topic:n==null?void 0:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getBalance",params:{assetId:void 0,address:e}}}});_(({params:p,topic:f})=>{const h=p.event.name,y=p.event.address??p.event.data.address;(h==="selectedAccountSynced"&&!t||h==="sharedAccountSynced"&&t&&y===e)&&o()}),m.useEffect(()=>{n&&!c&&o()},[n==null?void 0:n.topic]);const l=a?a.message:s&&s.error,i=s;return{balances:i==null?void 0:i.balances,error:l,loading:c}};function ne(){const t=!!v(),{data:n,error:r,loading:o,setData:s,setError:a,setLoading:c}=D(),[l]=E(u=>[u.setAccount]);async function i(){try{c(!0),a(void 0);const p=await(await S.getWalletConnectModalSignClient()).connect({requiredNamespaces:{aleo:{methods:S.wc_aleo_methods,chains:S.wc_aleo_chains,events:S.wc_events}}});s(p);const f=p.namespaces.aleo.accounts[0].split(":");return l({network:f[0],chainId:f[1],address:f[2],shortenedAddress:j(f[2])}),S.emitter.emit("session_change"),window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE"),p}catch(u){throw a(u),u}finally{c(!1)}}return{data:n,error:r,loading:o,isConnected:t,connect:i}}const re=()=>{const e=v(),{request:t,data:n,error:r,loading:o}=A({topic:(e==null?void 0:e.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"createSharedState",params:{}}}),s=r?r.message:n&&n.error,a=n;return{createSharedState:()=>{e&&!o&&t()},data:a==null?void 0:a.data,loading:o,error:s}},oe=e=>{S.log_sdk("useDecrypt",e);const t=v(),{request:n,data:r,error:o,loading:s}=A({topic:(t==null?void 0:t.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"decrypt",params:{ciphertexts:e}}}),a=o?o.message:r&&r.error,c=r;return{decrypt:()=>{e&&t&&!s&&n()},plaintexts:c==null?void 0:c.plaintexts,loading:s,error:a}};function se(){const e=v(),[t]=E(c=>[c.onDisconnect]),{error:n,loading:r,setError:o,setLoading:s}=D();async function a(){if(!e||r){e||t();return}try{s(!0),o(void 0);try{await(await S.getWalletConnectModalSignClient()).disconnect({topic:e.topic,reason:B.getSdkError("USER_DISCONNECTED")}),S.emitter.emit("session_change")}catch(c){console.warn(c)}E.getState().onDisconnect()}catch(c){throw o(c),c}finally{s(!1)}}return{error:n,loading:r,disconnect:a}}const ce=({id:e,address:t,multisig:n=!1})=>{const r=v(),[o]=E(w=>[w.account]),s=e!==void 0&&e!==""&&!!r&&!!o&&(n?!!t:!0),{refetch:a,data:c,error:l,isLoading:i}=P({queryKey:["useEvent",o==null?void 0:o.address,t,n,e,r==null?void 0:r.topic],enabled:s,wcParams:{topic:r==null?void 0:r.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getEvent",params:{id:e??"",address:t}}}});_(({params:w,topic:I})=>{const q=w.event.name,O=w.event.address??w.event.data.address;(e&&q==="selectedAccountSynced"&&!n||q==="sharedAccountSynced"&&n&&O===t)&&a()});const u=!!r&&!!o&&!!e&&(n?!!t:!0);m.useEffect(()=>{u&&!i&&a()},[u]);const p=()=>{u&&!i&&a()},f=l?l.message:c&&c.error,h=c,y=h==null?void 0:h.event;return{fetchEvent:p,event:y,error:f,loading:i}},ae=({filter:e,page:t})=>{const n=v(),[r]=E(y=>[y.account]);(e==null?void 0:e.programId)===""&&(e.programId=void 0);const{refetch:o,data:s,error:a,isLoading:c}=P({queryKey:["useEvents",r==null?void 0:r.address,e,t,n==null?void 0:n.topic],enabled:!!n&&!!r,wcParams:{topic:(n==null?void 0:n.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getEvents",params:{filter:e,page:t}}}});_(({id:y,params:w,topic:I})=>{w.event.name==="selectedAccountSynced"&&o()});const l=!!n&&!!r;m.useEffect(()=>{l&&!c&&o()},[l]);const i=()=>{l&&!c&&o()},u=a?a.message:s&&s.error,p=s,f=p==null?void 0:p.events,h=(p==null?void 0:p.pageCount)??0;return{fetchPage:i,events:f,error:u,loading:c,page:t,pageCount:h}},ie=e=>{const t=v(),{request:n,data:r,error:o,loading:s}=A({topic:(t==null?void 0:t.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"importSharedState",params:{seed:e}}}),a=o?o.message:r&&r.error,c=r;return{importSharedState:()=>{t&&!s&&n()},data:c==null?void 0:c.data,loading:s,error:a}},ue=e=>{try{return JSON.stringify(e,null,2).replaceAll('"',"")??""}catch{return""}},de=({address:e,multisig:t=!1,filter:n,page:r})=>{const o=v(),[s]=E(I=>[I.account]),{refetch:a,data:c,error:l,isLoading:i}=P({queryKey:["useRecords",s==null?void 0:s.address,e,t,n,r,o==null?void 0:o.topic],enabled:(t?!!e:!0)&&!!o&&!!s,wcParams:{topic:o==null?void 0:o.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getRecords",params:{address:e,filter:n,page:r}}}}),u=!!o&&!!s&&(t?!!e:!0);_(({params:I})=>{const q=I.event.name,O=I.event.address??I.event.data.address;(q==="selectedAccountSynced"&&!t||q==="sharedAccountSynced"&&t&&O===e)&&a()});const p=()=>{u&&!i&&(S.log_sdk("useRecords refetching...",[e,t,n,r]),a())},f=l?l.message:c&&c.error,h=c,y=h==null?void 0:h.records,w=(h==null?void 0:h.pageCount)??0;return{fetchPage:p,records:y,error:f,loading:i,page:r,pageCount:w}},le=e=>{const t=v(),n=e==null?void 0:e.inputs.map(u=>typeof u=="string"?u:u.plaintext),{request:r,data:o,error:s,loading:a}=A({topic:(t==null?void 0:t.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"requestCreateEvent",params:{...e,inputs:n}}}),c=s?s.message:o&&o.error,l=o;return{createEvent:()=>{e&&t&&!a&&(S.log_sdk("useCreateEvent requesting...",e),r())},eventId:l==null?void 0:l.eventId,loading:a,error:c}},W=$("wallet:sdk");W.enabled=!0;const pe=(e,t)=>{const n=v(),{request:r,data:o,error:s,loading:a}=A({topic:(n==null?void 0:n.topic)??"",chainId:"aleo:1",request:{jsonrpc:"2.0",method:"requestSignature",params:{message:e,address:d.aleoAddressRegex.test(t??"")?t:void 0}}}),c=s?s.message:o&&o.error;return{requestSignature:()=>{n&&!a&&(W("useRequestSignature requesting...",[e,t]),r())},response:o,loading:a,error:c}},U=new R.QueryClient,ge=({dAppName:e,dAppDescription:t,dAppUrl:n,dAppIconURL:r,children:o,debugQuery:s=!1})=>(m.useEffect(()=>{S.configureConnection({dAppName:e,dAppDescription:t,dAppUrl:n,dAppIconURL:r}),K.defaultMaxListeners=100},[]),k.jsxs(R.QueryClientProvider,{client:U,children:[s&&k.jsx(Z.ReactQueryDevtools,{initialIsOpen:!1}),o]})),he=async()=>{const e=await g(),t=await e.getSession();if(!t||!e)return{error:"no session or connection"};try{return await e.request({topic:t.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getSelectedAccount"}})}catch(n){const r=n.message;return console.error("getAccount error",r),{error:r}}},fe=async({address:e})=>{const t=await g(),n=await t.getSession();if(!n||!t)return{error:"no session or connection"};try{return await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getBalance",params:{assetId:void 0,address:e}}})}catch(r){const o=r.message;return console.error("getBalance error",o),{error:o}}},me=async()=>{const e=await g();if(!e)throw new Error("call setConnection() first!");const t=await e.getSession();if(t)return console.log("Already connected!",t),t;try{const n=await e.connect({requiredNamespaces:{aleo:{methods:N,chains:z,events:x}}});return C.emit("session_change"),window.localStorage.removeItem("WALLETCONNECT_DEEPLINK_CHOICE"),n}catch(n){console.error("connect error",n.message)}},ve=async e=>{const t=await g(),n=await(t==null?void 0:t.getSession());if(!n||!t)return{error:"no session or connection"};const r=e==null?void 0:e.inputs.map(o=>typeof o=="string"?o:o.plaintext);try{return await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"requestCreateEvent",params:{...e,inputs:r}}})}catch(o){const s=o.message;return console.error("createEvent error",s),{error:s}}},Se=async()=>{const e=await g(),t=await(e==null?void 0:e.getSession());if(!t||!e)return{error:"no session or connection"};try{return await e.request({topic:t.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"createSharedState",params:{}}})}catch(n){const r=n.message;return console.error("createSharedState error",r),{error:r}}},ye=async e=>{const t=await g(),n=await(t==null?void 0:t.getSession());if(!n||!t)return{error:"no session or connection"};try{return await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"decrypt",params:{ciphertexts:e}}})}catch(r){return console.error("decrypt error",r.message),{error:r.message}}},we=async()=>{const e=await g(),t=await(e==null?void 0:e.getSession());if(!t||!e)return{error:"no session or connection"};try{try{await e.disconnect({reason:B.getSdkError("USER_DISCONNECTED"),topic:t.topic}),C.emit("session_change")}catch(n){console.warn(n)}return{}}catch(n){const r=n.message;return console.error("error disconnecting",r),{error:r}}},Ee=async({id:e,address:t})=>{const n=await g(),r=await(n==null?void 0:n.getSession());if(!r||!n)return{event:void 0,error:"no session or connection"};const o=async()=>await n.request({topic:r.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getEvent",params:{id:e,address:t}}});try{return await o()}catch(s){const a=s.message;return console.error("getEvents error",a),{error:a}}},Ie=async e=>{const t=await g(),n=await(t==null?void 0:t.getSession());if(!n||!t)return{events:void 0,error:"no session or connection"};(e==null?void 0:e.programId)===""&&(e.programId=void 0);const r=async(o=0)=>await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getEvents",params:{filter:e,page:o}}});try{return await r()}catch(o){const s=o.message;return console.error("getEvents error",s),{error:s}}},qe=async e=>{const t=await g(),n=await(t==null?void 0:t.getSession());if(!n||!t)return{error:"no session or connection"};try{return await t.request({topic:n.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"importSharedState",params:{seed:e}}})}catch(r){const o=r.message;return console.error("importSharedState error",o),{error:o}}},_e=async({address:e,filter:t,page:n=0})=>{const r=await g(),o=await(r==null?void 0:r.getSession());if(!o||!r)return{error:"no session or connection"};const s=async(a=0)=>await r.request({topic:o.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"getRecords",params:{address:e,filter:t,page:a}}});try{return await s()}catch(a){const c=a.message;return console.error("getRecords error",c),{error:c}}},be=async({message:e,address:t})=>{const n=await g(),r=await(n==null?void 0:n.getSession());if(!r||!n)return{error:"no session or connection"};try{return await n.request({topic:r.topic,chainId:"aleo:1",request:{jsonrpc:"2.0",method:"requestSignature",params:{message:e,address:d.aleoAddressRegex.test(t??"")?t:void 0}}})}catch(o){const s=o.message;return console.error("signature error",s),{error:s}}},Ce=20;Object.defineProperty(exports,"AssetType",{enumerable:!0,get:()=>d.AssetType});Object.defineProperty(exports,"EventStatus",{enumerable:!0,get:()=>d.EventStatus});Object.defineProperty(exports,"EventType",{enumerable:!0,get:()=>d.EventType});Object.defineProperty(exports,"Network",{enumerable:!0,get:()=>d.Network});Object.defineProperty(exports,"Visibility",{enumerable:!0,get:()=>d.Visibility});Object.defineProperty(exports,"aleoAddressRegex",{enumerable:!0,get:()=>d.aleoAddressRegex});Object.defineProperty(exports,"aleoFieldRegex",{enumerable:!0,get:()=>d.aleoFieldRegex});Object.defineProperty(exports,"aleoPrivateKeyRegex",{enumerable:!0,get:()=>d.aleoPrivateKeyRegex});Object.defineProperty(exports,"aleoTransactionIdRegex",{enumerable:!0,get:()=>d.aleoTransactionIdRegex});Object.defineProperty(exports,"aleoU32",{enumerable:!0,get:()=>d.aleoU32});Object.defineProperty(exports,"aleoU64",{enumerable:!0,get:()=>d.aleoU64});Object.defineProperty(exports,"aleoViewKeyRegex",{enumerable:!0,get:()=>d.aleoViewKeyRegex});Object.defineProperty(exports,"zodAddress",{enumerable:!0,get:()=>d.zodAddress});Object.defineProperty(exports,"zodEventStatus",{enumerable:!0,get:()=>d.zodEventStatus});Object.defineProperty(exports,"zodEventType",{enumerable:!0,get:()=>d.zodEventType});Object.defineProperty(exports,"zodField",{enumerable:!0,get:()=>d.zodField});Object.defineProperty(exports,"zodNetwork",{enumerable:!0,get:()=>d.zodNetwork});Object.defineProperty(exports,"zodPrivateKey",{enumerable:!0,get:()=>d.zodPrivateKey});Object.defineProperty(exports,"zodTransactionId",{enumerable:!0,get:()=>d.zodTransactionId});Object.defineProperty(exports,"zodU32",{enumerable:!0,get:()=>d.zodU32});Object.defineProperty(exports,"zodU64",{enumerable:!0,get:()=>d.zodU64});Object.defineProperty(exports,"zodViewKey",{enumerable:!0,get:()=>d.zodViewKey});Object.defineProperty(exports,"zodVisibility",{enumerable:!0,get:()=>d.zodVisibility});exports.PAGE_SIZE=Ce;exports.PuzzleWalletProvider=ge;exports.configureConnection=Y;exports.connect=me;exports.createSharedState=Se;exports.decrypt=ye;exports.disconnect=we;exports.emitter=C;exports.getAccount=he;exports.getBalance=fe;exports.getEvent=Ee;exports.getEvents=Ie;exports.getFormattedRecordPlaintext=ue;exports.getRecords=_e;exports.getWalletConnectModalSignClient=g;exports.importSharedState=qe;exports.log_sdk=W;exports.projectId=V;exports.queryClient=U;exports.requestCreateEvent=ve;exports.requestSignature=be;exports.shortenAddress=j;exports.signClient_puzzleProps=X;exports.useAccount=ee;exports.useBalance=te;exports.useConnect=ne;exports.useCreateSharedState=re;exports.useDecrypt=oe;exports.useDisconnect=se;exports.useEvent=ce;exports.useEvents=ae;exports.useImportSharedState=ie;exports.useOnSessionDelete=T;exports.useOnSessionEvent=_;exports.useOnSessionExpire=F;exports.useOnSessionUpdate=L;exports.useRecords=de;exports.useRequestCreateEvent=le;exports.useRequestSignature=pe;exports.useSession=v;exports.wc_aleo_chains=z;exports.wc_aleo_methods=N;exports.wc_events=x;exports.web3modal_puzzle_props=M;
